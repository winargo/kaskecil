doctype html
title Category
meta(charset='UTF-8')
meta(name='viewport' content='width=device-width, initial-scale=1')
link(rel='stylesheet' href='https://www.w3schools.com/w3css/4/w3.css')
link(rel='stylesheet' href='https://fonts.googleapis.com/css?family=Raleway')
link(rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous")
//link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css')
link(rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css' integrity='sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO' crossorigin='anonymous')
script(src='https://code.jquery.com/jquery-3.3.1.slim.min.js' integrity='sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo' crossorigin='anonymous')
script(src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js' integrity='sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49' crossorigin='anonymous')
script(src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js' integrity='sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy' crossorigin='anonymous')
<!-- Custom styles for this template -->
link(href="css/simple-sidebar.css" rel="stylesheet")
// Latest compiled and minified CSS
link(rel='stylesheet' href='css/bootstrap-select.css')
link(rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/css/bootstrap-select.min.css')
// Latest compiled and minified JavaScript
script(src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/js/bootstrap-select.min.js')
// (Optional) Latest compiled and minified JavaScript translation files
script(src='https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.2/js/i18n/defaults-*.min.js')
script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js')
script(src='js/bootstrap-select.js')
style.
  html,body,h1,h2,h3,h4,h5 {font-family: "Raleway", sans-serif}
  a:hover{
  text-decoration: none;
  }
  .dropdown-toggle, .dropdown-menu { 
    width: 300px 
  }
 .btn-group img { margin-right: 10px }
 .dropdown-toggle { padding-right: 50px }
 .dropdown-toggle .glyphicon { margin-left: 20px; margin-right: -40px }

 .dropdown-header { background: #ccc; font-size: 14px; font-weight: 700; padding-top: 5px; padding-bottom: 5px; margin-top: 10px; margin-bottom: 5px }

  #fixedpost{
  position: fixed;
  float: right;
  border-radius: 90%;
  margin-left: 70%;
  font-size: 15px;
  }
// Top container
.w3-bar.w3-top.w3-black.w3-large(style='z-index:4;opacity:0.8')
  button.w3-bar-item.w3-button.w3-hide-large.w3-hover-none.w3-hover-text-light-grey(onclick='w3_open();')
    i.fa.fa-bars
    |  &nbsp;Menu
  button.w3-right.w3-btn.btn-primary.w3-padding(onclick='w3_logout()') Logout
  a.w3-bar-item.w3-text-white(href='#')
    | PrimaCash
// Sidebar/menu
nav#mySidebar.w3-sidebar.w3-collapse.w3-white.w3-animate-left(style='z-index:3;width:300px;')
  #wrapper.toggled(style="margin-top:43px;")
    // Sidebar
    #sidebar-wrapper
      ul.sidebar-nav.w3-margin-top
        .w3-container.w3-row
          .w3-col.s4
            img.w3-circle.w3-margin-right(src='https://www.w3schools.com/w3images/avatar2.png' style='width:46px')
          .w3-col.s8.w3-bar.w3-text-white
            span
              | Welcome,
              strong #{username}
            br
            a.w3-bar-item.w3-button(href='#')
              i.fa.fa-envelope
            a.w3-bar-item.w3-button(href='#')
              i.fa.fa-user
            a.w3-bar-item.w3-button(href='#')
              i.fa.fa-cog
        
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='/dashboard')
            i.fa.fa-home.fa-fw.w3-left
              | &nbsp; Dashboard
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='/income')
            i.fa.fa-arrow-circle-down.fa-fw.w3-left
              | &nbsp; Income 
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='/expense')
            i.fa.fa-arrow-circle-up.fa-fw.w3-left
              | &nbsp; Expense
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='/transfer')
            i.fa.fa-exchange-alt.fa-fw.w3-left
              | &nbsp; Transfer
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='/account')
            i.fa.fa-users.fa-fw.w3-left
              | &nbsp; Account
        li
          a.w3-bar-item.w3-button.w3-padding-16.w3-blue(href='#')
            i.fa.fa-list-ol.fa-fw.w3-left
              | &nbsp; Category
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='/report')
            i.fa.fa-clipboard-list.fa-fw.w3-left
              | &nbsp; Report
        li
          a.w3-bar-item.w3-button.w3-padding-16(href='chart.html')
            i.fa.fa-chart-bar.fa-fw.w3-left
              | &nbsp; Chart
  //- br
  //- .w3-container.w3-row
  //-   .w3-col.s4
  //-     img.w3-circle.w3-margin-right(src='https://www.w3schools.com/w3images/avatar2.png' style='width:46px')
  //-   .w3-col.s8.w3-bar
  //-     span
  //-       | Welcome,
  //-       strong #{username}
  //-     br
  //-     a.w3-bar-item.w3-button(href='#')
  //-       i.fa.fa-envelope
  //-     a.w3-bar-item.w3-button(href='#')
  //-       i.fa.fa-user
  //-     a.w3-bar-item.w3-button(href='#')
  //-       i.fa.fa-cog
  //- hr
  //- .w3-container
  //-   h5 Dashboard
  //- .w3-bar-block
  //-   a.w3-bar-item.w3-button.w3-padding-16.w3-hide-large.w3-dark-grey.w3-hover-black(href='home.html' onclick='w3_close()' title='close menu')
  //-     i.fa.fa-remove.fa-fw
  //-     | &nbsp; Close Menu
  //-   a.w3-bar-item.w3-button.w3-padding(href='/home')
  //-     i.fa.fa-home.fa-fw
  //-     | &nbsp; Overview
  //-   a.w3-bar-item.w3-button.w3-padding(href='/income')
  //-     i.fa.fa-users.fa-fw
  //-     | &nbsp; Income
  //-   a.w3-bar-item.w3-button.w3-padding(href='/expense')
  //-     i.fa.fa-bullseye.fa-fw
  //-     | &nbsp; Expenses
  //-   a.w3-bar-item.w3-button.w3-padding(href='/transfer')
  //-     i.fa.fa-exchange.fa-fw
  //-     | &nbsp; Transfer
  //-   a.w3-bar-item.w3-button.w3-padding(href='/account')
  //-     i.fa.fa-diamond.fa-fw
  //-     | &nbsp; Accounts
  //-   a.w3-bar-item.w3-button.w3-padding.w3-blue(href='#')
  //-     i.fa.fa-bell.fa-fw
  //-     | &nbsp; Category
  //-   a.w3-bar-item.w3-button.w3-padding(href='/report')
  //-     i.fa.fa-bank.fa-fw
  //-     | &nbsp; Report
  //-   a.w3-bar-item.w3-button.w3-padding(href='chart.html')
  //-     i.fa.fa-history.fa-fw
  //-     | &nbsp; Charts
  //-   br
  //-   br
// Overlay effect when opening sidebar on small screens
#myOverlay.w3-overlay.w3-hide-large.w3-animate-opacity(onclick='w3_close()' style='cursor:pointer' title='close side menu')
// !PAGE CONTENT!
.w3-main(style='margin-left:300px;margin-top:43px;')
  // Header
  header.w3-container(style='padding-top:22px')
    h5
      b
        i.fa.fa-dashboard
        |  My Category
    
    // Button trigger modal
    button.btn.btn-outline-dark(data-toggle='modal' data-target='#Income')
      i.fa.fa-plus-circle.fw-fa
      |  Add Category
    // Modal
    #Income.modal.fade(tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true')
      .modal-dialog.modal-dialog-centered(role='document')
        .modal-content
          .modal-header
            h5#exampleModalLongTitle.modal-title Create New Category
            button.close(type='button' data-dismiss='modal' aria-label='Close')
              span(aria-hidden='true') &times;
          form
            .modal-body
              .row
                .col-md-8
                  //label(for='1') Name Category
                  //input#first.form-control(type='text' name='namecate')
                  
                  label(for='1' style='margin-top:10px') Name Category
                  .select
                    img#imagename(style='margin-right:10px;width:24px;height:24px;display:inline-block' src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/falses.png') 
                      
                    select#selectname.custom-select(style='width:268px;display:inline-block' onchange='categname()' name='select_name' title="Select your category")
                        option(value='0' selected='') Select
                        each b, index in listcategory
                            option(value=''+[b]) #{b}
                  strong#error(style="color:red;display:none") Error
                  #inputname(style='display:none;margin-top:10px')
                    label(for='3') Category Name
                    input#catname.form-control(type='text' name='catename' oninput='refresh()')
                  strong#errorinputname(style="color:red;display:none") Error
                  //label(for='2') Category Number
                  input#catnums.form-control(type='hidden' name='categnums')

            .modal-footer
              button.btn.btn-secondary(type='button' data-dismiss='modal') Close
              button#add.btn.btn-primary(type='button' onclick='addcategory()') Add
  hr
  .w3-panel
    .w3-row-padding(style='margin:0 -8px')
      .row
          each r, index in list
            .col-md-3
              .card.border-secondary.mb-3(style='max-width: 18rem;')
                .card-header
                  if(r.category_image==31)
                    img#displayimage(style='margin-right:10px;width:36px;height:36px;display:inline-block' src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/add.png')
                    | #{r.category_name}
                  else
                    img#displayimage(style='margin-right:10px;width:36px;height:36px;display:inline-block' src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/'+[r.category_name]+'.png')
                    | #{r.category_name}
                  br
                  
                  // Delete Button
                  button.btn.btn-outline-dark(style='float:right' data-toggle='modal' data-target='#Delete'+r.category_name)
                    i.fa.fa-trash.fa-fw
                  // Modal
                  div.modal.fade(id='Delete'+r.category_name tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true')
                    .modal-dialog.modal-dialog-centered(role='document')
                      .modal-content
                        .modal-header
                          h5#exampleModalLongTitle.modal-title Delete Category
                          button.close(type='button' data-dismiss='modal' aria-label='Close')
                            span(aria-hidden='true') &times;
                        form(action='/deletecategory' method='post')
                          .modal-body
                            .row
                              .col-md-12
                                //label(for='1') Name Category
                                //input#first.form-control(type='text' name='namecate')
                                p Are you sure to delete category #{r.category_name} ?
                                //input#deletecatnums.form-control(type='hidden' name='deletecategnums' value=''+[r.category_image])
                                input(type='hidden' name='beforedeletecatename' value=''+r.category_name)
                          .modal-footer
                            button.btn.btn-secondary(type='button' data-dismiss='modal') Cancel
                            button.btn.btn-primary(type='submit') Delete

                  // Edit Button
                  button.btn.btn-outline-dark(style='float:right;margin-right:5px;' data-toggle='modal' data-target='#Edit'+r.category_name)
                    i.fa.fa-edit.fa-fw
                  // Modal
                  div.modal.fade(id='Edit'+r.category_name tabindex='-1' role='dialog' aria-labelledby='exampleModalCenterTitle' aria-hidden='true')
                    .modal-dialog.modal-dialog-centered(role='document')
                      .modal-content
                        .modal-header
                          h5#exampleModalLongTitle.modal-title Edit Category
                          button.close(type='button' data-dismiss='modal' aria-label='Close')
                            span(aria-hidden='true') &times;
                        form
                          .modal-body
                            .row
                              .col-md-8
                                //label(for='1') Name Category
                                //input#first.form-control(type='text' name='namecate')
                                
                                label(for='1' style='margin-top:10px') Name Category
                                .select
                                  if(r.category_image==31)
                                    img(id='editimagename'+index style='margin-right:10px;width:24px;height:24px;display:inline-block' src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/add.png') 
                                  else
                                    img(id='editimagename'+index style='margin-right:10px;width:24px;height:24px;display:inline-block' src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/'+[r.category_name]+'.png') 

                                  select.custom-select(id='editselectname'+index style='width:268px;display:inline-block' onchange='editcategname('+index+')' name='editselect_name' title="Select your category")
                                      option(value=''+r.category_name selected) #{r.category_name}
                                      each b, index in listcategory
                                        if(r.category_name==[b])

                                        else
                                          option(value=''+[b]) #{b}
                                
                                div(id='editinputname'+index style='display:none;margin-top:10px')
                                  label(for='3') Category Name
                                  input#editcatname.form-control(type='text' name='editcatename')
                                  
                                //label(for='2') Category Number
                                input.form-control(id='editcatnums'+index type='hidden' name='editcategnums' value=''+r.category_image)
                                
                                input(type='hidden' name='beforeeditcatename' value=''+r.category_name)

                          .modal-footer
                            button.btn.btn-secondary(type='button' data-dismiss='modal') Close
                            button.btn.btn-primary(type='button' onclick='editvalidasi()') Save
                  
                //.card-body.text-secondary
                  p#imagenums.card-text #{r.category_image}
                  
  
  
  
  // Footer
  //
    <footer class="w3-container w3-padding-16 w3-light-grey">
    <h4>FOOTER</h4>
    <p>Powered by Danny</p>
    </footer>
  // End page content

script(src="./js/axios.min.js")
script.
  // Get the Sidebar
  var mySidebar = document.getElementById("mySidebar");
  // Get the DIV with overlay effect
  var overlayBg = document.getElementById("myOverlay");
  // Toggle between showing and hiding the sidebar, and add overlay effect
  function w3_open() {
  if (mySidebar.style.display === 'block') {
  mySidebar.style.display = 'none';
  overlayBg.style.display = "none";
  } else {
  mySidebar.style.display = 'block';
  overlayBg.style.display = "block";
  }
  }

  function editcategname(index){
    
    var num;
    var tes = document.getElementById("editselectname"+index).value;
    console.log(index);
    document.getElementById("editinputname"+index).style.display="none";
    if(tes=='cashicon'){
      num=1;
    }
    else if(tes=='bank'){
      num=2;
    }
    else if(tes=='lend'){
      num=3;
    }
    else if(tes=='cheque'){
      num=4;
    }
    else if(tes=='creditcard'){
      num=5;
    }
    else if(tes=='food'){
      num=6;
    }
    else if(tes=='electric'){
      num=7;
    }
    else if(tes=='truck'){
      num=8;
    }
    else if(tes=='health'){
      num=9;
    }
    else if(tes=='ball'){
      num=10;
    }
    else if(tes=='house'){
      num=11;
    }
    else if(tes=='water'){
      num=12;
    }
    else if(tes=='clothes'){
      num=13;
    }
    else if(tes=='movie'){
      num=14;
    }
    else if(tes=='poker'){
      num=15;
    }
    else if(tes=='car'){
      num=16;
    }
    else if(tes=='accident'){
      num=17;
    }
    else if(tes=='daily'){
      num=18;
    }
    else if(tes=='tax'){
      num=19;
    }
    else if(tes=='pet'){
      num=20;
    }
    else if(tes=='computer'){
      num=21;
    }
    else if(tes=='plane'){
      num=22;
    }
    else if(tes=='gasoline'){
      num=23;
    }
    else if(tes=='garden'){
      num=24;
    }
    else if(tes=='bitcoin'){
      num=25;
    }
    else if(tes=='insurance'){
      num=26;
    }
    else if(tes=='investment'){
      num=27;
    }
    else if(tes=='fixing'){
      num=28;
    }
    else if(tes=='medical'){
      num=29;
    }
    else if(tes=='drink'){
      num=30;
    }
    else{
      num=31;
      tes='add';
      document.getElementById("editinputname"+index).style.display="block";
      
    }
    if(tes=='0'){
      document.getElementById("editcatnums"+index).value='';
      document.getElementById("editimagename"+index).src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/falses.png';
    }
    else{
      document.getElementById("editcatnums"+index).value=num;
      console.log(tes)
      document.getElementById("editimagename"+index).src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/'+tes+'.png';
    }
  }
  var error = document.getElementById("error");
  var errorinputname = document.getElementById("errorinputname");
  var categoryname='0';

  function refresh(){
    addbutton=false;
    error.style.display="none";
    errorinputname.style.display="none";
    addvalidasi();
  }
  function categname(){
    addbutton=false;
    error.style.display="none";
    errorinputname.style.display="none";
    var num;
    var tes = document.getElementById("selectname").value;
    categoryname=tes;
    document.getElementById("inputname").style.display="none";
    if(tes=='cashicon'){
      num=1;
    }
    else if(tes=='bank'){
      num=2;
    }
    else if(tes=='lend'){
      num=3;
    }
    else if(tes=='cheque'){
      num=4;
    }
    else if(tes=='creditcard'){
      num=5;
    }
    else if(tes=='food'){
      num=6;
    }
    else if(tes=='electric'){
      num=7;
    }
    else if(tes=='truck'){
      num=8;
    }
    else if(tes=='health'){
      num=9;
    }
    else if(tes=='ball'){
      num=10;
    }
    else if(tes=='house'){
      num=11;
    }
    else if(tes=='water'){
      num=12;
    }
    else if(tes=='clothes'){
      num=13;
    }
    else if(tes=='movie'){
      num=14;
    }
    else if(tes=='poker'){
      num=15;
    }
    else if(tes=='car'){
      num=16;
    }
    else if(tes=='accident'){
      num=17;
    }
    else if(tes=='daily'){
      num=18;
    }
    else if(tes=='tax'){
      num=19;
    }
    else if(tes=='pet'){
      num=20;
    }
    else if(tes=='computer'){
      num=21;
    }
    else if(tes=='plane'){
      num=22;
    }
    else if(tes=='gasoline'){
      num=23;
    }
    else if(tes=='garden'){
      num=24;
    }
    else if(tes=='bitcoin'){
      num=25;
    }
    else if(tes=='insurance'){
      num=26;
    }
    else if(tes=='investment'){
      num=27;
    }
    else if(tes=='fixing'){
      num=28;
    }
    else if(tes=='medical'){
      num=29;
    }
    else if(tes=='drink'){
      num=30;
    }
    else if(tes=='other'){
      num=31;
      tes='add';
      document.getElementById("inputname").style.display="block";
    }
    if(tes=='0'){
      document.getElementById("catnums").value='';
      document.getElementById("imagename").src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/falses.png';
    }
    else{
      document.getElementById("catnums").value=num;
      document.getElementById("imagename").src='https://raw.githubusercontent.com/winargo/midascash/master/app/src/main/res/drawable/'+tes+'.png';
    }
    addvalidasi();
  }
  var addbutton=false;
  function addcategory(){
    addbutton=true;
    addvalidasi();
  }
  // Close the sidebar with the close button
  function w3_close() {
    mySidebar.style.display = "none";
    overlayBg.style.display = "none";
  }

  
  var addvalid=true;
  //- var categoryname = document.getElementById("selectname").value;
  
  //- var addcat = document.getElementById("addcat");
  //- var add = document.getElementById("add").value;
  //- add.addEventListener("click", addvalidasi);

  function addvalidasi(){
    addvalid=true;
    axios.get('/listcategory')
    .then(response=> {
      console.log(categoryname);
      
      if(categoryname=='0'){
        addvalid=false;
        error.innerHTML="Please Select Category Name";
        error.style.display="inline";
      }
      else if(categoryname=='other'){
        if(document.getElementById('catname').value==""){
          errorinputname.innerHTML="Please Input Category Name";
          errorinputname.style.display="inline";
        }
      }
      for(var i=0;i<response.data.datacategory.length;i++){
        console.log(response.data.datacategory[i]);
        if(response.data.datacategory[i]==categoryname){
          addvalid=false;
          error.innerHTML="Category Name already exist";
          error.style.display="inline";
        }
        else if(response.data.datacategory[i]==document.getElementById('catname').value){
          addvalid=false;
          errorinputname.innerHTML="Category Name already exist";
          errorinputname.style.display="inline";
        }
      }
      if(addvalid){
        if(addbutton){
          if(categoryname=="other"){
            axios.post('/authcategory', {
              catename: document.getElementById('catname').value,
              categnums: document.getElementById('catnums').value
            })
              .then(response=> {
                window.location.replace ("/category");
                console.log(response.data);
            })
            .catch(function (error) {
              console.log(error);
            });
          }
          else{
            axios.post('/authcategory', {
              catename: document.getElementById('selectname').value,
              categnums: document.getElementById('catnums').value
            })
              .then(response=> {
                window.location.replace ("/category");
                console.log(response.data);
            })
            .catch(function (error) {
              console.log(error);
            });
          }
        }
      }
    })
    .catch(function (error) {
      console.log(error);
    });
  }
  

  function editvalidasi(){
    axios.get('/category/listcategory')
    .then(response=> {
      console.log(categoryname);
      for(var i=0;i<response.data.datacategory.length;i++){
        console.log(response.data.datacategory[i]);
        if(response.data.datacategory[i]==categoryname){
          addvalid=false;
          error.innerHTML="Category Name already exist";
          error.style.display="inline";
        }
      }
      if(addvalid){
        error.style.display="none";
        if(categoryname=="other"){
          axios.post('/category/authcategory', {
            catename: document.getElementById('catname').value,
            categnums: document.getElementById('catnums').value
          })
            .then(response=> {
              window.location.replace ("/category");
              console.log(response.data);
          })
          .catch(function (error) {
            console.log(error);
          });
        }
        else{
          axios.post('/category/authcategory', {
            catename: document.getElementById('selectname').value,
            categnums: document.getElementById('catnums').value
          })
            .then(response=> {
              window.location.replace ("/category");
              console.log(response.data);
          })
          .catch(function (error) {
            console.log(error);
          });
        }
      }
    })
    .catch(function (error) {
      console.log(error);
    });
  }

  function w3_logout(){
  window.location.replace('/');
  }

